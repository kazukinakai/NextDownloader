# NextDownloader プロジェクト計画書

## プロジェクト目的と背景

NextDownloaderは、様々な形式のコンテンツを簡単かつ高速にダウンロードするためのクロスプラットフォームアプリケーションです。MP4、HLS、DASH、YouTubeなど、多様なコンテンツタイプに対応し、ユーザーフレンドリーなインターフェースを提供します。

### 主な目標

- 高速で信頼性の高いダウンロード機能の提供
- クロスプラットフォーム対応（デスクトップ・モバイル）
- 使いやすいユーザーインターフェース
- 拡張性と保守性の高いアーキテクチャ

## アーキテクチャ設計

NextDownloaderは、以下の主要コンポーネントで構成されています：

### 1. コアエンジン（Rust）

- ダウンロード機能
- コンテンツタイプ検出
- メディア処理
- 依存関係管理

### 2. FFIレイヤー

- C FFI: 安定性が高く広く採用
- UniFFI: 多言語バインディング自動生成（Swift, Kotlin, Python, JavaScript）

### 3. プラットフォーム固有実装

- デスクトップ: Tauri（Rust + Web技術）
- モバイル: Tauri 2.0（iOS, Android）
- ネイティブUI: SwiftUI（macOS, iOS）, WinUI（Windows）

### 4. プラグインシステム

- ダウンロードプラグイン
- メディア処理プラグイン
- 拡張機能プラグイン

## 技術スタック

### バックエンド

- **言語**: Rust
- **非同期処理**: Tokio
- **エラー処理**: thiserror
- **シリアライズ**: serde
- **HTTP通信**: reqwest
- **ダウンロードツール**: yt-dlp, aria2c
- **メディア処理**: ffmpeg

### フロントエンド

- **フレームワーク**: React + TypeScript
- **UIライブラリ**: Chakra UI
- **状態管理**: React Context API
- **ルーティング**: React Router

### クロスプラットフォーム

- **デスクトップ**: Tauri 2.0
- **モバイル**: Tauri 2.0（iOS, Android）
- **FFI**: UniFFI, C FFI

## ディレクトリ構造

```
NextDownloader/
├── apps/                     # アプリケーション
│   ├── desktop/              # デスクトップアプリ（Tauri）
│   ├── mobile/               # モバイルアプリ（Tauri 2.0対応）
│   └── web/                  # Webアプリ（オプション）
├── cli/                      # コマンドラインインターフェース
├── core/                     # Rustコア機能
│   ├── downloader/           # ダウンロード機能
│   ├── parser/               # パース機能
│   └── common/               # 共通機能
├── ffi/                      # FFIレイヤー
│   ├── c-ffi/                # C FFI
│   ├── uniffi/               # UniFFI
│   └── bindings/             # 生成されたバインディング
├── packages/                 # 共通パッケージ
│   ├── ui/                   # UI共通コンポーネント
│   ├── config/               # 設定管理
│   └── utils/                # ユーティリティ
├── platforms/                # プラットフォーム固有実装
│   ├── macos/                # macOS固有実装
│   ├── windows/              # Windows固有実装
│   └── linux/                # Linux固有実装
├── plugins/                  # Tauriプラグイン
│   ├── download/             # ダウンロードプラグイン
│   └── media/                # メディア処理プラグイン
└── docs/                     # ドキュメント
```

## コーディング規約とスタイルガイド

### Rust

- Rustfmtを使用したコードフォーマット
- Clippyによる静的解析
- エラー処理にはthiserrorを使用
- 非同期処理にはTokioを使用
- ドキュメントコメントを積極的に記述

### TypeScript/React

- ESLintとPrettierを使用したコードフォーマット
- 関数コンポーネントとHooksの使用
- 型安全性の確保
- コンポーネントの責務を明確に分離

## テスト戦略

### ユニットテスト

- Rustコア機能のテスト: cargo test
- React/TypeScriptのテスト: Jest, React Testing Library

### 統合テスト

- FFIレイヤーのテスト
- プラグインのテスト
- UIフローのテスト

### E2Eテスト

- 実際のダウンロードシナリオのテスト
- クロスプラットフォーム動作の検証

## デプロイメントフロー

### ビルドプロセス

1. Rustコアのビルド
2. FFIバインディングの生成
3. フロントエンドのビルド
4. Tauriアプリケーションのパッケージング

### CI/CD

- GitHub Actionsを使用した自動ビルド
- クロスプラットフォームビルド
- 自動テスト実行
- リリースパッケージの生成

## ロードマップ

### フェーズ1: 基盤構築（現在）

- Rustコア機能の実装
- FFIレイヤーの整備（C FFI, UniFFI）
- Tauriデスクトップアプリの基本実装

### フェーズ2: 機能拡張

- ダウンロード機能の強化
- UIの改善
- プラグインシステムの実装
- モバイル対応（Tauri 2.0）

### フェーズ3: 最適化と拡張

- パフォーマンスの最適化
- プラットフォーム固有機能の強化
- 拡張機能エコシステムの構築
- ユーザーフィードバックに基づく改善

## 課題と対策

### 技術的課題

- **FFIの複雑性**: UniFFIを活用して自動生成を行い、保守性を向上
- **クロスプラットフォーム対応**: Tauriを活用し、プラットフォーム間の差異を吸収
- **依存関係の管理**: 明確なバージョン管理と互換性テスト

### プロジェクト管理

- 明確なタスク管理（docs/TASK.md）
- 知識の共有と蓄積（docs/KNOWLEDGE.md）
- 定期的な進捗確認と方向性の調整